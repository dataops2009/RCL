<!DOCTYPE html>
<html>
<head>
    <title>Create a Team</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <!-- Main Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('RCL_Home_Screen') }}">RCL</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-item nav-link" href="{{ url_for('RCL_Home_Screen') }}">Home</a>
                    <a class="nav-item nav-link" href="{{ url_for('RCL_Login_Screen') }}">Login</a>
                    <a class="nav-item nav-link" href="{{ url_for('RCL_Forgot_Password_Screen') }}">Forgot Password</a>
                    <a class="nav-item nav-link" href="{{ url_for('RCL_Signup_Screen') }}">Sign Up</a>
                    <a class="nav-item nav-link" href="{{ url_for('RCL_Tournament_Screen') }}">Tournaments</a>
                    <a class="nav-item nav-link" href="{{ url_for('RCL_League_Screen') }}">Leagues</a>
                    <a class="nav-item nav-link" href="{{ url_for('RCL_Matches_Screen') }}">Matches</a>
                    <a class="nav-item nav-link" href="{{ url_for('RCL_Player_Profile_Screen') }}">Player Profile</a>
                    <a class="nav-item nav-link" href="{{ url_for('RCL_Player_Ranking_Screen') }}">Player Ranking</a>
                    <a class="nav-item nav-link" href="{{ url_for('RCL_Recruitment_Centre_Screen') }}">Recruitment Centre</a>
                    <a class="nav-item nav-link" href="{{ url_for('RCL_My_Account_Screen') }}">My Account</a>
                    <a class="nav-item nav-link" href="{{ url_for('RCL_Team_Management_Screen') }}">Team Management</a>
                    <a class="nav-item nav-link" href="{{ url_for('RCL_Team_Profile_Screen') }}">Team Profile</a>
                    <a class="nav-item nav-link" href="{{ url_for('RCL_Team_Ranking_Screen') }}">Team Ranking</a>
                    <a class="nav-item nav-link" href="{{ url_for('RCL_Subcription_Screen') }}">Subscription</a>
                    <a class="nav-item nav-link" href="{{ url_for('RCL_Eagle_Eye_Screen') }}">Eagle Eye</a>
                </div>
            </div>
        </div>
    </nav>
    <h1>Create a Team</h1>
    <form action="/create-team" method="POST" id="create-team-form">
        <label for="name">Team Name:</label>
        <input type="text" id="name" name="name" required><br><br>

        <!-- Displaying the logged-in user as the captain -->
        <p>Captain: {{ session['username'] }}</p>

        <label for="co_captain_id">Co-Captain ID:</label>
        <input type="text" id="co-captain-search" placeholder="Search for Co-Captain and select"><br>
        <select id="co-captain-list" name="co_captain" required>
            <option value="" disabled selected>Select Co-Captain</option>
            {% for player in player_list %}
                <option value="{{ player }}">{{ player }}</option>
            {% endfor %}
        </select><br><br>

        <label for="all-players">All Players:</label>
        <input type="text" id="player-search-all" placeholder="Search for players"><br>
        <select id="all-players" name="all-players[]" multiple required>
            {% for player in player_list %}
                <option value="{{ player }}">{{ player }}</option>
            {% endfor %}
        </select><br><br>

        <label>Selected Players:</label>
        <input type="text" id="player-search-selected" placeholder="Search for players"><br>
        <select id="selected-players" name="selected-players[]" multiple required></select><br><br>

        <button type="button" id="add-player-button">Add Player</button>
        <button type="button" id="remove-player-button">Remove Player</button><br><br>

        <input type="submit" value="Create Team">
    </form>

    <script>
        // JavaScript code to add and remove players and filter dropdown options
        const addPlayerButton = document.getElementById("add-player-button");
        const removePlayerButton = document.getElementById("remove-player-button");
        const allPlayersDropdown = document.getElementById("all-players");
        const selectedPlayersDropdown = document.getElementById("selected-players");
        const captainDropdown = document.getElementById("captain-list");
        const coCaptainDropdown = document.getElementById("co-captain-list");
        const playerSearchAll = document.getElementById("player-search-all");
        const playerSearchSelected = document.getElementById("player-search-selected");
        const captainSearch = document.getElementById("captain-search");
        const coCaptainSearch = document.getElementById("co-captain-search");

        // Function to filter options in a dropdown based on the search input
        function filterDropdown(dropdown, searchInput) {
            const searchText = searchInput.value.toLowerCase();
            const options = dropdown.options;
            for (let i = 0; i < options.length; i++) {
                const optionText = options[i].text.toLowerCase();
                if (optionText.includes(searchText)) {
                    options[i].style.display = "";
                } else {
                    options[i].style.display = "none";
                }
            }
        }

                function refreshPage() {
            setTimeout(function() {
                location.reload();
            }, 1000); // Delay of 1 second before refreshing
        }

        // Function to add a player from the all players dropdown to the selected players dropdown
        addPlayerButton.addEventListener("click", () => {
            const selectedOptions = allPlayersDropdown.selectedOptions;
            for (const option of selectedOptions) {
                if (!Array.from(selectedPlayersDropdown.options).some(selectedOption => selectedOption.value === option.value)) {
                    selectedPlayersDropdown.appendChild(option.cloneNode(true));
                }
            }
        });

        removePlayerButton.addEventListener("click", () => {
    const selectedOptions = Array.from(selectedPlayersDropdown.selectedOptions);
    const playerIds = selectedOptions.map(option => option.value);

    fetch('/remove-players', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ playerIds: playerIds })
    })
    .then(response => {
        if (response.ok) {
            refreshPage();
        } else {
            console.error('Failed to remove players');
        }
    })
    .catch(error => console.error('Error:', error));
});


        // Function to remove selected players from the selected players dropdown
        removePlayerButton.addEventListener("click", () => {
            const selectedOptions = selectedPlayersDropdown.selectedOptions;
            for (const option of selectedOptions) {
                selectedPlayersDropdown.removeChild(option);
                
            }
         
        });



        // Add event listeners for filtering dropdown options
        playerSearchAll.addEventListener("input", () => {
            filterDropdown(allPlayersDropdown, playerSearchAll);
        });

        playerSearchSelected.addEventListener("input", () => {
            filterDropdown(selectedPlayersDropdown, playerSearchSelected);
        });

        captainSearch.addEventListener("input", () => {
            filterDropdown(captainDropdown, captainSearch);
        });

        coCaptainSearch.addEventListener("input", () => {
            filterDropdown(coCaptainDropdown, coCaptainSearch);
        });
    </script>
</body>
</html>
